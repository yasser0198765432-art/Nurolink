<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nurolink Project ‚Äî Healix Team</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --main:#444;
  --accent:#44ff88;
  --dark:#111;
  --muted:#bdbdbd;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:"Cairo",sans-serif;
  background:linear-gradient(180deg,#2b2b2b,#111);
  color:#fff;
  text-align:center;
  padding:20px;
}
header{margin-bottom:20px;}
.hero{margin:20px auto;max-width:600px;border-radius:14px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.5);}
.hero img{width:100%;display:block;border-radius:14px;}
.leds{display:flex;justify-content:center;gap:20px;margin:20px 0;}
.led{width:50px;height:50px;border-radius:50%;background:#333;transition:.2s;}
.led.on{box-shadow:0 0 20px var(--accent);background:var(--accent);}
button{padding:10px 20px;margin:5px;border-radius:6px;cursor:pointer;font-size:16px;}
img.test-img{width:200px;height:200px;border-radius:10px;margin:15px;border:2px solid var(--accent);}
#log{margin-top:20px;max-height:200px;overflow-y:auto;text-align:left;background:#222;padding:10px;border-radius:8px;}
#score{margin-top:10px;font-size:18px;color:var(--accent);}
</style>
</head>
<body>

<header>
  <h1>Nurolink Project</h1>
  <p>Memory & Recognition Test with ESP32 BLE</p>
</header>

<div class="hero">
  <img src="https://i.postimg.cc/brQtbbxw/Screenshot-20260204-192014-Canva.jpg" alt="Project Banner">
</div>

<h2>LED & Memory Test</h2>
<div class="leds">
  <div class="led" id="led0"></div>
  <div class="led" id="led1"></div>
  <div class="led" id="led2"></div>
  <div class="led" id="led3"></div>
</div>

<button id="startStopBtn">Start / Stop LED</button>
<button id="connectBtn">Connect to ESP32</button>
<p id="status">Status: Not connected</p>

<h3>Test Image</h3>
<img id="testImage" class="test-img" src="" alt="Test Image">

<div>
<button id="btnFamily">Family</button>
<button id="btnFriends">Friends</button>
<button id="btnUnknown">Unknown</button>
</div>

<p id="score">Current Level: 1 / 10</p>
<div id="log"></div>

<script>
let leds = [0,1,2,3].map(i=>document.getElementById('led'+i));
let log = document.getElementById('log');
let scoreDisplay = document.getElementById('score');
let status = document.getElementById('status');

let images=[
  {url:"https://picsum.photos/id/1015/200/200", category:"Family"},
  {url:"https://picsum.photos/id/1016/200/200", category:"Family"},
  {url:"https://picsum.photos/id/1025/200/200", category:"Friends"},
  {url:"https://picsum.photos/id/1027/200/200", category:"Unknown"},
  {url:"https://picsum.photos/id/1035/200/200", category:"Unknown"},
  {url:"https://picsum.photos/id/1037/200/200", category:"Friends"},
  {url:"https://picsum.photos/id/1040/200/200", category:"Family"},
  {url:"https://picsum.photos/id/1041/200/200", category:"Friends"},
  {url:"https://picsum.photos/id/1042/200/200", category:"Unknown"},
  {url:"https://picsum.photos/id/1043/200/200", category:"Family"}
];

let level = 1;
let maxLevels = 10;

function randomOrder(){
  let arr=[0,1,2,3];
  for(let i=0;i<4;i++){
    let j=Math.floor(Math.random()*(4-i))+i;
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

let ledInterval, ledRunning = false;
function playLEDs(){
  let order=randomOrder();
  let i=0;
  if(ledInterval) clearInterval(ledInterval);
  ledInterval = setInterval(()=>{
    leds.forEach(l=>l.classList.remove('on'));
    leds[order[i]].classList.add('on');
    i++;
    if(i>=order.length){
      clearInterval(ledInterval);
      leds.forEach(l=>l.classList.remove('on'));
      ledRunning=false;
    }
  },500);
  ledRunning=true;
}

document.getElementById('startStopBtn').addEventListener('click', ()=>{
  if(ledRunning){
    clearInterval(ledInterval);
    leds.forEach(l=>l.classList.remove('on'));
    ledRunning=false;
    log.innerHTML+='üö´ LED stopped<br>';
  } else{
    playLEDs();
    log.innerHTML+='‚ñ∂Ô∏è LED started<br>';
  }
});

function nextImage(){
  let img=images[Math.floor(Math.random()*images.length)];
  let testImg=document.getElementById('testImage');
  testImg.src=img.url;
  testImg.dataset.category=img.category;
}

let device, characteristic;
document.getElementById('connectBtn').addEventListener('click', async ()=>{
  try{
    status.textContent="Status: Searching for ESP32...";
    device = await navigator.bluetooth.requestDevice({filters:[{services:['6e400001-b5a3-f393-e0a9-e50e24dcca9e']}]});
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e');
    characteristic = await service.getCharacteristic('6e400002-b5a3-f393-e0a9-e50e24dcca9e');
    await characteristic.startNotifications();
    characteristic.addEventListener('characteristicvaluechanged', handleESP32Data);
    status.textContent="Status: Connected to ESP32";
    log.innerHTML+='üîó Connected to ESP32<br>';
  }catch(err){
    console.error(err);
    status.textContent="Connection Failed";
  }
});

function handleESP32Data(event){
  let index=parseInt(new TextDecoder().decode(event.target.value));
  if(!isNaN(index)&&index>=0&&index<=3){
    leds.forEach(l=>l.classList.remove('on'));
    leds[index].classList.add('on');
    log.innerHTML+=`LED ${index} pressed via ESP32<br>`;
    log.scrollTop=log.scrollHeight;
  }
}

['btnFamily','btnFriends','btnUnknown'].forEach(id=>{
  document.getElementById(id).addEventListener('click', e=>{
    let choice=e.target.textContent;
    let correct=document.getElementById('testImage').dataset.category;
    log.innerHTML+=`Patient choice: ${choice} | Correct: ${correct}<br>`;
    level++;
    scoreDisplay.textContent=`Current Level: ${level} / ${maxLevels}`;
    if(level<=maxLevels){
      nextImage();
      playLEDs();
    } else{
      log.innerHTML+='<b>Test finished!</b><br>';
    }
    log.scrollTop=log.scrollHeight;
  });
});

nextImage();
</script>

<footer>
¬© 2026 Healix Team ‚Äî Nurolink Project
</footer>

</body>
</html>